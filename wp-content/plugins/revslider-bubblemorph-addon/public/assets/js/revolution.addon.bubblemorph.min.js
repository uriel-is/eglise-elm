(function(){"use strict";var t,e;window.BubbleMorphAddOn=function(s,r,a){if(!s||!r)return;t=s;e=t(window);t.event.special.rsBubbleMorphDestroyed={remove:function(t){t.handler()}};return new i(r,a)};function i(t,e){this.slider=t;this.carousel=e;t.one("revolution.slide.onloaded",this.onLoaded.bind(this)).one("rsBubbleMorphDestroyed",this.destroy.bind(this))}i.prototype={onLoaded:function(){var e,i=this.slider,s=this.carousel;var r=t.fn.revolution&&t.fn.revolution[i[0].id]?t.fn.revolution[i[0].id]:false;if(!r)return;this.revObj=r;var a=r.gridwidth,h=r.responsiveLevels;if(!Array.isArray(a))a=[a];while(a.length<4)a[a.length]=a[a.length-1];for(e=0;e<4;e++)a[e]=parseInt(a[e],10);if(h){if(!Array.isArray(h))h=[h];while(h.length<4)h[h.length]=h[h.length-1];for(e=0;e<4;e++)h[e]=parseInt(h[e],10)}this.morph=i.find(".tp-bubblemorph").each((function(){var e=t(this),l=e.attr("data-bubblemorph");try{l=JSON.parse(l)}catch(t){return}var n=t("<canvas />").appendTo(e),o=l.num,f=l.speedx,u=l.speedy,b=l.bufferx,p=l.buffery;var c=e.attr("data-dim");if(!c)return;c=c.split(";");var v=false,g=false,w=c.length;for(var y=0;y<w;y++){if(c[y].charAt(0).toLowerCase()==="w"){v=c[y].replace("w:","").split(",")}else if(c[y].charAt(0).toLowerCase()==="h"){g=c[y].replace("h:","").split(",")}if(v!==false&&g!==false)break}if(v===false||g===false)return;while(v.length<4)v[v.length]=v[v.length-1];while(g.length<4)g[g.length]=g[g.length-1];while(g.length<v.length)g[g.length]=g[g.length-1];while(v.length<g.length)g[v.length]=v[v.length-1];o=o.split("|");b=b.split("|");p=p.split("|");f=f.split("|");u=u.split("|");var x=e.hasClass("rs-layer-static")?e.closest("rs-static-layers"):e.closest("rs-slide");var m={opt:r,velX:f,velY:u,layr:e,grids:a,layerW:v,layerH:g,slider:i,levels:h,bufferX:b,bufferY:p,canvas:n[0],carousel:s,numBubbles:o,wrapper:e.closest("rs-layer-wrap"),isStatic:e.hasClass("rs-layer-static"),color:d(l.bg),fullAlign:this.getAttribute("data-basealign")==="slide",slotholder:x.find("rs-sbg-wrap"),slideIndex:e.hasClass("rs-layer-static")?9999:parseInt(x.attr("data-originalindex"),10)};var M=l.blur;if(M){m.blurStrength=M.split("|");m.blurColor=l.blurcolor.split("|");m.blurX=l.blurx.split("|");m.blurY=l.blury.split("|")}var I=l.bordersize;if(I){m.borderSize=I.split("|");m.borderColor=l.bordercolor.split("|")}e.data("bubbleObj",m)}));if(this.morph.length){if(this.revObj.onBeforeSwap!==undefined){this.beforeChange.call(this,null,this.revObj.onBeforeSwap)}i.on("leftviewport",this.leftViewport.bind(this)).on("enterviewport",this.enterViewport.bind(this)).on("revolution.slide.onbeforeswap",this.beforeChange.bind(this)).on("revolution.slide.onafterswap",this.afterSwap.bind(this)).on("revolution.slide.afterdraw",this.onResize.bind(this)).on("revolution.slideprepared",this.slidePrepared.bind(this))}else{this.destroy()}},slidePrepared:function(t,e){if(this.waitingForSlidePrepare){this.beforeChange.call(this,null,this.revObj.onBeforeSwap)}},beforeChange:function(t,e){this.waitingForSlidePrepare=false;if(!(this.revObj.slidePresets&&this.revObj.slidePresets[e.nextSlideLIIndex])){this.waitingForSlidePrepare=true;return}this.slider.find(".tp-bubblemorph").data("bubbleIndex",parseInt(e.nextSlideIndex,10));this.slider.one("revolution.slide.layeraction",this.layerAction.bind(this))},afterSwap:function(e,i){var s=i.slideIndex-1;this.slider[0].activeBubbleIndex=s;this.slider.find("rs-slide").each((function(e,i){t(i).find(".tp-bubblemorph").each((function(){if(e!==s){this.bubbleSlideIndex=e;var i=t(this);var r=i.data("bubbleaddon");if(r)n(r,i)}}))}))},enterViewport:function(){var e=this.slider[0].activeBubbleIndex;this.slider.find(".tp-bubblemorph").each((function(){var i=t(this);var s=i.data("bubbleaddon");if(s&&s.paused&&(this.bubbleSlideIndex===undefined||this.bubbleSlideIndex===e)){l(s,i)}}))},leftViewport:function(e){this.slider.find(".tp-bubblemorph").each((function(){var e=t(this);var i=e.data("bubbleaddon");if(i){n(i,e)}}))},createBubbles:function(){this.morph.each(h)},onResize:function(t){clearTimeout(this.resizeTimer);this.resizeTimer=setTimeout(this.resize.bind(this),250)},resize:function(){this.morph.each((function(){var e=t(this);var i=e.data("bubbleaddon");if(!i)return;s.call(e);h.call(e)}))},layerAction:function(e){this.slider.find(".tp-bubblemorph").each((function(){var e=t(this);var i=e.data("bubbleaddon");if(!i){h.call(e)}i=e.data("bubbleaddon");if(!i)return;if(!i.screen||!i.screen.width||!i.screen.height){h.call(e);i=e.data("bubbleaddon")}if(i.paused){l(i,e)}}))},checkRemoved:function(){if(!this.slider||!document.body.contains(this.slider[0])){this.destroy();return true}return false},destroy:function(){this.slider.find(".tp-bubblemorph").each((function(){var e=t(this),i=e.data("bubbleaddon");i.paused=true;e.removeData("bubbleaddon bubbleObj")}));for(var e in this){if(this.hasOwnProperty(e))delete this[e]}}};function s(){var e=t(this),i=e.data("bubbleaddon");if(i){i.destroy();e.removeData("bubbleaddon")}}function r(t,e){if(!t)return false;if(e===0)return t[e];var i=e,s=t[e];while(s==="inherit"){i--;if(i>-1)s=t[i];else s=t[0]}return s}function a(t){var i=t.levels,s=i.length,r=e.width(),a=0,h,l,n;if(i){for(var o=0;o<s;o++){n=i[o];if(l===n)continue;if(r<n)a=o;l=n}}var d=t.layerW[a],f=t.layerH[a],u=d==="100%"||d==="full",b=f==="100%"||f==="full";if(!u){d=parseInt(t.layr.css("width"),10)}else{var p=!t.carousel||t.isStatic?t.slider:t.slotholder;if(t.fullAlign){d=p.width();t.wrapper[0].style.left=0}else{h=Math.min(t.slider.width()/t.grids[a],1);d=t.grids[a]*h}}if(!b){f=parseInt(t.layr.css("height"),10)}else{f=!t.isStatic?t.slotholder.height():t.slider.height();t.wrapper[0].style.top=0}return{width:d,height:f,level:a}}function h(){var e=t(this),i=e.data("bubbleObj"),h=false;var n=e.data("bubbleaddon");if(!i)return;if(i.slideIndex===9999&&parseInt(e.data("bubbleIndex"),0)>=parseInt(e.data("startslide"),0)&&parseInt(e.data("bubbleIndex"),0)<=parseInt(e.data("endslide"),0))h=true;if(e.data("bubbleIndex")!=i.slideIndex&&h!==true)return;if(n){s.call(this)}var o=a(i);var d=o.level;var f=r(i.blurStrength,d),u=r(i.borderSize,d),b=r(i.borderColor,d),c=r(i.blurColor,d),v=r(i.blurX,d),g=r(i.blurY,d),w=r(i.bufferX,d),y=r(i.bufferY,d),x=r(i.numBubbles,d),m=r(i.velX,d),M=r(i.velY,d);var I=p(o.width,o.height,i.slider,i.canvas,parseInt(x,10),i.color,parseInt(f,10),c,parseInt(v,10),parseInt(g,10),b,parseInt(u,10),parseInt(w,10),parseInt(y,10),parseFloat(m),parseFloat(M),i.opt.bw);e.data("bubbleaddon",I);if(e.data("bubblesplaying"))l(I,e)}function l(t,e){t.paused=false;t.screen.resize();if(!t.started){t.started=true;t.inited()}e.data("bubblesplaying",true);t.play()}function n(t,e){t.paused=true;e.data("bubblesplaying",false)}function o(t){var e=t.colors,i=e.length,s=[],r;for(var a=0;a<i;a++){var h=e[a];delete h.align;if(r){if(JSON.stringify(h)!==JSON.stringify(r))s[s.length]=h}else{s[s.length]=h}r=h}t.colors=s;return t}function d(t){if(typeof t==="object"){t=o(t);return[t,true]}if(t.trim()==="transparent"){return["#FFFFFF",false]}else if(t.search(/\[\{/)!==-1){try{t=JSON.parse(t.replace(/\&/g,'"'));t=o(t);return[t,true]}catch(t){return["#FFFFFF",false]}}else if(t.search("#")!==-1){return[t,false]}else if(t.search("rgba")!==-1){return[t.replace(/\s/g,"").replace(/false/g,"1"),false]}else if(t.search("rgb")!==-1){return[t.replace(/\s/g,""),false]}else{return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)?[t,false]:["#FFFFFF",false]}}function f(t,e,i,s){return"rgba("+t+", "+e+", "+i+", "+s+")"}function u(t,e,i,s){e*=.5;i*=.5;var r=t.createRadialGradient(e,i,0,e,i,e),a=s.length,h;for(var l=0;l<a;l++){h=s[l];r.addColorStop(h.position*.01,f(h.r,h.g,h.b,h.a))}return r}function b(t,e,i,s,r){var a=0,h=0,l=0,n=0,o;r=parseInt(r,10);if(/0|90|180|270|360/.test(r)){switch(r){case 0:case 360:h=i;break;case 90:l=e;break;case 180:n=i;break;case 270:a=e;break}}else{e*=.5;i*=.5;var d=(r-180)*(Math.PI/180),u=i/Math.cos(d),b=e-Math.sqrt(u*u-i*i),p=Math.sin(d)*b;o=u+p;a=e+Math.cos(-Math.PI/2+d)*o,h=i+Math.sin(-Math.PI/2+d)*o,l=e+Math.cos(Math.PI/2+d)*o,n=i+Math.sin(Math.PI/2+d)*o}var c=t.createLinearGradient(Math.round(a),Math.round(h),Math.round(l),Math.round(n)),v,g;o=s.length;for(var w=0;w<o;w++){v=s[w];g=parseInt(v.position,10);c.addColorStop(g*.01,f(v.r,v.g,v.b,v.a))}return c}function p(t,e,i,s,r,a,h,l,n,o,d,f,p,c,v,g,w){var y;var x={screen:{elem:null,callback:null,ctx:null,width:0,height:0,left:0,top:0,init:function(t,e){this.elem=s;this.callback=t||null;if(this.elem.tagName=="CANVAS")this.ctx=this.elem.getContext("2d");this.elem.onselectstart=function(){return false};this.elem.ondrag=function(){return false};e&&this.resize();return this},resize:function(){var i=this.elem;this.width=t;this.height=e;for(this.left=0,this.top=0;i!=null;i=i.offsetParent){this.left+=i.offsetLeft;this.top+=i.offsetTop}if(this.ctx){this.elem.width=this.width;this.elem.height=this.height}if(y){y.width=this.width;y.height=this.height}this.callback&&this.callback()},destroy:function(){for(var t in this)if(this.hasOwnProperty(t))delete this[t]}}};var m=function(t,e){this.x=t;this.y=e;this.magnitude=t*t+e*e;this.computed=0;this.force=0};m.prototype.add=function(t){return new m(this.x+t.x,this.y+t.y)};var M=function(t){var e=.1;var i=1.5;this.vel=new m((Math.random()>.5?1:-1)*(.2+Math.random()*v),(Math.random()>.5?1:-1)*(.2+Math.random()*g));this.pos=new m(t.width*.2+Math.random()*t.width*.6,t.height*.2+Math.random()*t.height*.6);this.size=t.wh/Math.min(30,15/w)+(Math.random()*(i-e)+e)*(t.wh/Math.min(30,15/w));this.width=t.width;this.height=t.height};M.prototype.move=function(){if(this.pos.x>=this.width-this.size-p){if(this.vel.x>0)this.vel.x=-this.vel.x;this.pos.x=this.width-this.size-p}else if(this.pos.x<=this.size+p){if(this.vel.x<0)this.vel.x=-this.vel.x;this.pos.x=this.size+p}if(this.pos.y>=this.height-this.size-c){if(this.vel.y>0)this.vel.y=-this.vel.y;this.pos.y=this.height-this.size-c}else if(this.pos.y<=this.size+c){if(this.vel.y<0)this.vel.y=-this.vel.y;this.pos.y=this.size+c}this.pos=this.pos.add(this.vel)};var I=function(t,e,i,s){this.step=5;this.width=t;this.height=e;this.wh=Math.min(t,e);this.sx=Math.floor(this.width/this.step);this.sy=Math.floor(this.height/this.step);this.paint=false;this.metaFill=F(t,e,s);this.plx=[0,0,1,0,1,1,1,1,1,1,0,1,0,0,0,0];this.ply=[0,0,0,0,0,0,1,0,0,1,1,1,0,1,0,1];this.mscases=[0,3,0,3,1,3,0,3,2,2,0,2,1,1,0];this.ix=[1,0,-1,0,0,1,0,-1,-1,0,1,0,0,1,1,0,0,0,1,1];this.grid=[];this.balls=[];this.iter=0;this.sign=1;for(var r=0;r<(this.sx+2)*(this.sy+2);r++){this.grid[r]=new m(r%(this.sx+2)*this.step,Math.floor(r/(this.sx+2))*this.step)}for(var a=0;a<i;a++){this.balls[a]=new M(this)}};I.prototype.destroy=function(){var t;for(t in this.balls)if(this.balls.hasOwnProperty(t))delete this.balls[t];for(t in this)if(this.hasOwnProperty(t))delete this[t]};I.prototype.computeForce=function(t,e,i){var s;var r=i||t+e*(this.sx+2);if(t===0||e===0||t===this.sx||e===this.sy){s=.6*this.sign}else{s=0;var a=this.grid[r];if(!a)return;var h=0;var l;while(l=this.balls[h++]){s+=l.size*l.size/(-2*a.x*l.pos.x-2*a.y*l.pos.y+l.pos.magnitude+a.magnitude)}s*=this.sign}if(!this.grid[r])return;this.grid[r].force=s;return s};I.prototype.marchingSquares=function(t){var e=t[0];var i=t[1];var s=t[2];var r=e+i*(this.sx+2);if(!this.grid[r])return;if(this.grid[r].computed===this.iter){return false}var a,h=0,l;for(var n=0;n<4;n++){var o=e+this.ix[n+12]+(i+this.ix[n+16])*(this.sx+2);if(!this.grid[o]){l=true;break}var d=this.grid[o].force;if(d>0&&this.sign<0||d<0&&this.sign>0||!d){d=this.computeForce(e+this.ix[n+12],i+this.ix[n+16],o)}if(Math.abs(d)>1)h+=Math.pow(2,n)}if(l)return;if(h===15){return[e,i-1,false]}else{if(h===5)a=s===2?3:1;else if(h===10)a=s===3?0:2;else{a=this.mscases[h];if(!this.grid[r])return;this.grid[r].computed=this.iter}var f=this.step/(Math.abs(Math.abs(this.grid[e+this.plx[4*a+2]+(i+this.ply[4*a+2])*(this.sx+2)].force)-1)/Math.abs(Math.abs(this.grid[e+this.plx[4*a+3]+(i+this.ply[4*a+3])*(this.sx+2)].force)-1)+1);O.lineTo(this.grid[e+this.plx[4*a]+(i+this.ply[4*a])*(this.sx+2)].x+this.ix[a]*f,this.grid[e+this.plx[4*a+1]+(i+this.ply[4*a+1])*(this.sx+2)].y+this.ix[a+4]*f);this.paint=true;return[e+this.ix[a+4],i+this.ix[a+8],a]}};I.prototype.renderMetaballs=function(){var t=0,e;while(e=this.balls[t++])e.move();this.iter++;this.sign=-this.sign;this.paint=false;O.fillStyle=this.metaFill;if(h){O.shadowBlur=h;O.shadowColor=l;O.shadowOffsetX=n;O.shadowOffsetY=o}if(f){O.strokeStyle=d;O.lineWidth=f}O.beginPath();t=0;while(e=this.balls[t++]){var i=[Math.round(e.pos.x/this.step),Math.round(e.pos.y/this.step),false];do{i=this.marchingSquares(i)}while(i);if(this.paint){O.fill();O.closePath();if(f)O.stroke();O.beginPath();this.paint=false}}};var F=function(t,e,i){if(i[1]){i=i[0];if(i.type==="radial"){return u(O,t,e,i.colors)}else{return b(O,t,e,i.colors,i.angle)}}return i[0]};var S=function(){if(!C||C.paused)return;O.clearRect(0,0,z.width,z.height);y.renderMetaballs();requestAnimationFrame(S)};var z=x.screen.init(null,true),O=z.ctx;var P=function(){if(y)y.destroy();y=new I(z.width,z.height,r,a)};function A(){C.paused=true;cancelAnimationFrame(S);O.clearRect(0,0,z.width,z.height);if(y)y.destroy();z.destroy();y=null;x=null;m=null;M=null;I=null;S=null;z=null;C=null;P=null;F=null;O=null}var C={play:S,paused:true,screen:z,inited:P,started:false,destroy:A,height:e,width:t};return C}})();